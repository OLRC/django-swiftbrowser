{% extends "base.html" %}
{% load l10n %}
{% load i18n %}
{% load dateconv %}
{% load lastpart %}
{% block content %}
<div id='objectview'>
<div class="row">
	<div class="small-12 columns">
		{% include "messages.html" %}
	</div>
</div>
<div class="row">
	<div class="small-12 large-8 columns">
		<ul class="breadcrumbs">
			<li><a href="{% url "containerview" %}">Containers</a></li> 
			<li>
				<a href="{% url "objectview" container=container %}">{{container}}</a>
			</li>
			{% for prefix in prefixes %}
			<li>
				<a href="{% url "objectview" container=container prefix=prefix.full_name %}">{{prefix.display_name}}</a>
			</li>
			{% endfor %}
		</ul>
</div>
<div class="row">
	<div class="small-12 large-4 columns">		
		<button type="button" data-reveal-id="fileForm" class="button">Upload Files</button>
		<button type="button" data-reveal-id="pseudoContainer" class="button">New Folder</button>
	</div>
</div>
</div> 
{% if public %}
<div class="row">
<div class="small-12 columns">
	<div data-alert class="alert-box secondary">
		<strong>{% trans 'Public URL:' %}</strong>
		<a href="{{ base_url }}{% url "public_objectview" account=account container=container %}" target="new">
			{{ base_url }}{% url "public_objectview" account=account container=container %}
		</a>
		<a href="#" class="close">&times;</a>
	</div>
</div> 
</div>
{% endif %}
<div class="row">
	<div class="small-12 columns">
		<script type="text/javascript">
			$( document ).ready(function() {
				loadTable();
				
			});
			function loadTable() {
				$.ajax({
					url: '{% url "objecttable" %}',
					success: function(data) {
						$('#objecttable').html(data);
						$(document).foundation();
					}
				});	
			}
		</script>
		<div id="objecttable"></div>
	</div>
</div>
<div class="reveal-modal" id="fileForm" data-reveal aria-labelledby="fileForm-title" aria-hidden="true" role="dialog">
	<h2 id="fileForm-title">Add Files</h2>
	<a class="close-reveal-modal" aria-label="Close">&#215;</a>
	{% load jfutags %}
	{% jfu 'upload_form.html' %}
</div>
<div class="reveal-modal" id="pseudoContainer" data-reveal aria-labelledby="pseudoContainer-title" aria-hidden="true" role="dialog">
	
	<h2 id="pseudoContainer-title">Make a new folder</h2>
	<form method="POST" id="create-pseudofolder">
	    <fieldset>
	    <legend>{% trans 'Create a new pseudofolder' %}</legend>
	    {% csrf_token %}
  
	    <div class="control-group">
	        <label class="control-label" for="foldername">{% trans "Foldername" %}</label>
	        <div class="controls">
	            <input id="foldername" name="foldername" class="input-xlarge" type="text" placeholder="{% trans "Foldername" %}">
	            <span class="help-block">
	                {% trans "Enter name of pseudofolder here." %}
	                {% trans "Please note that you can not rename it afterwards." %}
	            </span>
	        </div>
	    </div>

	    <div class="control-group">
	        <div class="controls">
	            <button type="submit" class="btn btn-primary">{% trans 'Create' %}</button>
	            {% if prefix %}
	        <a href="{% url "objectview" container=container prefix=prefix %}" class="btn" >
	    {% else %}
	        <a href="{% url "objectview" container=container %}" class="btn" >
	    {% endif %}
	    {% trans 'Cancel' %}</a>
	         </div>
	    </div>
	  </fieldset>
	</form>
	<div id="progress">
	<div class="loader">Loading...</div>
	</div>
	
	
	
</div>
</div>
{% endblock %}
{% block jsadd %}
<script type="text/javascript"> 		
	$('input[id=file]').change(function() { $('#filetmp').val($(this).val()); });	
		
	$('#create-pseudofolder').on('submit', function(event){
		event.preventDefault();
		$("#create-pseudofolder").hide();
		$("#progress").show();
		create_post();
		
	});
	
	function create_post() {
		$.post(
			{% if prefix %}
			"{% url "create_pseudofolder" container=container prefix=prefix %}", //url
			{% else %}
			"{% url "create_pseudofolder" container=container %}", //url
			{% endif %}
			$('#create-pseudofolder').serialize(), //data
			function() {	//success method
				$('#pseudoContainer').foundation('reveal', 'close');
				loadTable();
				$('#pfold').html('<div data-alert class="alert-box success radius">Shit works<a href="#" class="close">&times;</a></div>');
			}
		).fail(function() {
			$('#pfold').html('<div data-alert class="alert-box alert radius">Shit no works<a href="#" class="close">&times;</a></div>');
		});
 	}
</script> 
{% endblock %}

